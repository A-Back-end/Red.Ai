<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTM Comprehensive Test - Red.AI</title>
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KMRVH2GD');</script>
    <!-- End Google Tag Manager -->
    
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover { background: #0056b3; }
        .test-button.success { background: #28a745; }
        .test-button.danger { background: #dc3545; }
        
        .status {
            margin: 15px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 8px;
            border-radius: 3px;
            font-size: 12px;
        }
        .log-success { background: #d4edda; }
        .log-error { background: #f8d7da; }
        .log-info { background: #d1ecf1; }
        
        .counter {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KMRVH2GD"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="container">
        <h1>ğŸ”¬ GTM Comprehensive Test - Red.AI</h1>
        <p>Complete testing suite for Google Tag Manager integration</p>
        <p><strong>GTM Container ID:</strong> GTM-KMRVH2GD</p>
        
        <div id="status" class="status info">
            <strong>Status:</strong> Initializing GTM tests...
        </div>
        
        <div class="grid">
            <div>
                <h2>ğŸ¯ Basic GTM Tests</h2>
                <button class="test-button" onclick="testPageView()">ğŸ“„ Page View</button>
                <button class="test-button" onclick="testCustomEvent()">âš¡ Custom Event</button>
                <button class="test-button" onclick="testUserInteraction()">ğŸ‘† User Interaction</button>
                <button class="test-button" onclick="testEcommerce()">ğŸ’° E-commerce</button>
                
                <h2>ğŸ¤– Red.AI Specific Tests</h2>
                <button class="test-button" onclick="testAIFeature()">ğŸ§  AI Feature</button>
                <button class="test-button" onclick="testDesignGen()">ğŸ¨ Design Generation</button>
                <button class="test-button" onclick="testProjectSave()">ğŸ’¾ Project Save</button>
                <button class="test-button" onclick="testCreditUsage()">ğŸ’ Credit Usage</button>
            </div>
            
            <div>
                <h2>ğŸ” Debugging Tools</h2>
                <button class="test-button" onclick="showGTMInfo()">â„¹ï¸ GTM Info</button>
                <button class="test-button" onclick="showDataLayer()">ğŸ“Š DataLayer</button>
                <button class="test-button" onclick="monitorNetwork()">ğŸŒ Network Monitor</button>
                <button class="test-button" onclick="openGTMPreview()">ğŸ”— GTM Preview</button>
                
                <h2>ğŸ“ˆ Real-time Check</h2>
                <button class="test-button" onclick="openRealTime()">ğŸ“Š Open GA4 Real-time</button>
                <button class="test-button" onclick="testSequence()">ğŸ”„ Test Sequence</button>
                <button class="test-button" onclick="clearLogs()">ğŸ—‘ï¸ Clear Logs</button>
            </div>
        </div>
        
        <div class="container">
            <h2>ğŸ“ Event Log <span id="eventCounter" class="counter">0</span></h2>
            <div id="eventLog"></div>
        </div>
        
        <div class="container">
            <h2>ğŸ”§ Network Monitoring</h2>
            <div id="networkLog"></div>
        </div>
        
        <div class="container">
            <h2>ğŸ“Š Debug Information</h2>
            <div id="debugInfo"></div>
        </div>
    </div>

    <script>
        let eventCount = 0;
        let networkRequests = [];
        
        // Initialize on page load
        window.addEventListener('load', function() {
            setTimeout(initializeTests, 1000);
            monitorNetworkRequests();
        });
        
        function initializeTests() {
            checkGTMStatus();
            logEvent('ğŸš€ GTM Test Suite initialized', 'info');
        }
        
        function checkGTMStatus() {
            const statusDiv = document.getElementById('status');
            const checks = [];
            
            // Check dataLayer
            if (window.dataLayer && Array.isArray(window.dataLayer)) {
                checks.push('âœ… dataLayer initialized');
                checks.push(`ğŸ“Š dataLayer length: ${window.dataLayer.length}`);
            } else {
                checks.push('âŒ dataLayer missing');
            }
            
            // Check GTM script
            const gtmScript = document.querySelector('script[src*="googletagmanager.com/gtm"]');
            if (gtmScript) {
                checks.push('âœ… GTM script loaded');
            } else {
                checks.push('âŒ GTM script not found');
            }
            
            // Check for GTM container
            if (window.dataLayer && window.dataLayer.some(item => item['gtm.start'])) {
                checks.push('âœ… GTM container initialized');
            } else {
                checks.push('âŒ GTM container not initialized');
            }
            
            const allGood = checks.every(check => check.includes('âœ…') || check.includes('ğŸ“Š'));
            statusDiv.className = allGood ? 'status success' : 'status error';
            statusDiv.innerHTML = '<strong>GTM Status:</strong><br>' + checks.join('<br>');
        }
        
        function sendGTMEvent(eventName, parameters = {}) {
            if (typeof window !== 'undefined' && window.dataLayer) {
                const eventData = {
                    event: eventName,
                    ...parameters,
                    timestamp: new Date().toISOString(),
                    test_mode: true
                };
                
                window.dataLayer.push(eventData);
                logEvent(`ğŸ“¤ Sent: ${eventName}`, 'success', eventData);
                updateCounter();
                return true;
            } else {
                logEvent(`âŒ Failed to send: ${eventName} (dataLayer not available)`, 'error');
                return false;
            }
        }
        
        // Test functions
        function testPageView() {
            sendGTMEvent('page_view', {
                page_path: '/test-gtm-comprehensive',
                page_title: 'GTM Comprehensive Test'
            });
        }
        
        function testCustomEvent() {
            sendGTMEvent('custom_event', {
                category: 'testing',
                action: 'manual_test',
                label: 'gtm_comprehensive_test'
            });
        }
        
        function testUserInteraction() {
            sendGTMEvent('user_interaction', {
                action: 'click',
                category: 'test',
                label: 'test_button',
                value: 1
            });
        }
        
        function testEcommerce() {
            sendGTMEvent('purchase', {
                transaction_id: 'test_' + Date.now(),
                value: 99.99,
                currency: 'USD',
                items: [{
                    item_id: 'test_credit_pack',
                    item_name: 'Test Credit Pack',
                    category: 'credits',
                    quantity: 1,
                    price: 99.99
                }]
            });
        }
        
        function testAIFeature() {
            sendGTMEvent('ai_feature_usage', {
                feature: 'test_ai_designer',
                action: 'generate_design',
                room_type: 'living_room',
                style: 'modern'
            });
        }
        
        function testDesignGen() {
            sendGTMEvent('design_generation', {
                design_type: 'interior_design',
                room_type: 'bedroom',
                style: 'scandinavian',
                generation_time: 45
            });
        }
        
        function testProjectSave() {
            sendGTMEvent('project_creation', {
                project_type: 'interior_design',
                has_images: true,
                room_count: 3
            });
        }
        
        function testCreditUsage() {
            sendGTMEvent('credit_usage', {
                feature: 'ai_design_generation',
                credits_used: 5,
                credits_remaining: 95
            });
        }
        
        function showGTMInfo() {
            const info = {
                dataLayer_available: !!window.dataLayer,
                dataLayer_length: window.dataLayer ? window.dataLayer.length : 0,
                gtm_container_id: 'GTM-KMRVH2GD',
                user_agent: navigator.userAgent,
                page_url: window.location.href,
                timestamp: new Date().toISOString(),
                gtm_initialized: window.dataLayer && window.dataLayer.some(item => item['gtm.start'])
            };
            
            document.getElementById('debugInfo').innerHTML = `
                <h3>GTM Configuration Info</h3>
                <pre>${JSON.stringify(info, null, 2)}</pre>
            `;
        }
        
        function showDataLayer() {
            document.getElementById('debugInfo').innerHTML = `
                <h3>ğŸ“Š DataLayer Contents</h3>
                <pre>${JSON.stringify(window.dataLayer || [], null, 2)}</pre>
            `;
        }
        
        function monitorNetwork() {
            document.getElementById('networkLog').innerHTML = `
                <h3>ğŸŒ Network Requests to Google Tag Manager</h3>
                <p>Monitoring GTM requests... Open DevTools Network tab for detailed view.</p>
                <pre>${JSON.stringify(networkRequests, null, 2)}</pre>
            `;
        }
        
        function monitorNetworkRequests() {
            // Override fetch to monitor GTM requests
            const originalFetch = window.fetch;
            window.fetch = function(...args) {
                const url = args[0];
                if (typeof url === 'string' && (url.includes('googletagmanager.com') || url.includes('google-analytics.com'))) {
                    networkRequests.push({
                        url: url,
                        timestamp: new Date().toISOString(),
                        method: 'fetch'
                    });
                }
                return originalFetch.apply(this, args);
            };
        }
        
        function openGTMPreview() {
            const previewUrl = 'https://tagassistant.google.com/';
            logEvent('ğŸ”— Opening Google Tag Assistant for GTM preview', 'info');
            window.open(previewUrl, '_blank');
        }
        
        function openRealTime() {
            const realTimeUrl = 'https://analytics.google.com/analytics/web/#/p0/realtime/rt-overview';
            logEvent('ğŸ“Š Opening GA4 Real-time reports', 'info');
            window.open(realTimeUrl, '_blank');
        }
        
        function testSequence() {
            logEvent('ğŸ”„ Starting GTM test sequence...', 'info');
            
            setTimeout(() => testPageView(), 500);
            setTimeout(() => testUserInteraction(), 1000);
            setTimeout(() => testAIFeature(), 1500);
            setTimeout(() => testDesignGen(), 2000);
            setTimeout(() => testProjectSave(), 2500);
            setTimeout(() => testCreditUsage(), 3000);
            setTimeout(() => testEcommerce(), 3500);
            
            setTimeout(() => {
                logEvent('âœ… GTM test sequence completed!', 'success');
            }, 4000);
        }
        
        function logEvent(message, type = 'info', data = null) {
            const logDiv = document.getElementById('eventLog');
            const timestamp = new Date().toLocaleTimeString();
            
            let logClass = 'log-info';
            if (type === 'success') logClass = 'log-success';
            if (type === 'error') logClass = 'log-error';
            
            let logEntry = `<div class="${logClass} log-entry">
                <strong>[${timestamp}]</strong> ${message}
            </div>`;
            
            if (data) {
                logEntry += `<pre class="log-entry">${JSON.stringify(data, null, 2)}</pre>`;
            }
            
            logDiv.innerHTML = logEntry + logDiv.innerHTML;
        }
        
        function updateCounter() {
            eventCount++;
            document.getElementById('eventCounter').textContent = eventCount;
        }
        
        function clearLogs() {
            document.getElementById('eventLog').innerHTML = '';
            document.getElementById('networkLog').innerHTML = '';
            document.getElementById('debugInfo').innerHTML = '';
            eventCount = 0;
            updateCounter();
            logEvent('ğŸ—‘ï¸ Logs cleared', 'info');
        }
        
        // Auto-test on load
        setTimeout(() => {
            testPageView();
            logEvent('ğŸ¯ Auto page view test completed', 'success');
        }, 2000);
    </script>
</body>
</html> 