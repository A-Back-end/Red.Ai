# üîê Clerk Production Setup - Red.AI

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

Development —Ä–µ–∂–∏–º Clerk **–æ—Ç–∫–ª—é—á–µ–Ω**. –¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å production –∫–ª—é—á–∞–º–∏.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:

1. **middleware.ts** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ test –∫–ª—é—á–∏
2. **app/layout.tsx** - –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è test –∫–ª—é—á–µ–π  
3. **next.config.js** - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è production
4. **scripts/** - —Å–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

## üöÄ –ö–∞–∫ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ Production

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ Production –∫–ª—é—á–∏ Clerk

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://dashboard.clerk.com
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **"API Keys"** –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **"Publishable key"** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `pk_live_`)
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **"Secret key"** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk_live_`)
6. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **"Webhooks"** –∏ —Å–æ–∑–¥–∞–π—Ç–µ webhook:
   - URL: `https://redai.site/api/webhooks/clerk`
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ webhook secret (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `whsec_`)

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç–µ .env.production

–ó–∞–º–µ–Ω–∏—Ç–µ placeholder –∑–Ω–∞—á–µ–Ω–∏—è –≤ `.env.production`:

```bash
# Clerk Production Keys
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_live_YOUR_ACTUAL_PRODUCTION_KEY
CLERK_SECRET_KEY=sk_live_YOUR_ACTUAL_SECRET_KEY
CLERK_WEBHOOK_SECRET=whsec_YOUR_ACTUAL_WEBHOOK_SECRET
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
node scripts/check-clerk-env.js

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
./scripts/switch-to-production-clerk.sh
```

### –®–∞–≥ 4: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ

```bash
# –°–±–æ—Ä–∫–∞ –¥–ª—è production
npm run build

# –ó–∞–ø—É—Å–∫ production —Å–µ—Ä–≤–µ—Ä–∞
npm start
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

### –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (Development):
- ‚ùå –ö–ª—é—á–∏: `pk_test_*`, `sk_test_*`
- ‚ùå –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞
- ‚ùå –ù–µ –≥–æ—Ç–æ–≤ –¥–ª—è production

### –¶–µ–ª–µ–≤–æ–π —Å—Ç–∞—Ç—É—Å (Production):
- ‚úÖ –ö–ª—é—á–∏: `pk_live_*`, `sk_live_*`
- ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ì–æ—Ç–æ–≤ –¥–ª—è deployment

## üìÅ –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- `.env` - development –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (test –∫–ª—é—á–∏)
- `.env.production` - production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (live –∫–ª—é—á–∏)
- `middleware.ts` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π
- `app/layout.tsx` - —É—Å–ª–æ–≤–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `next.config.js` - production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üõ†Ô∏è –°–∫—Ä–∏–ø—Ç—ã

### `scripts/check-clerk-env.js`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Clerk:
```bash
node scripts/check-clerk-env.js
```

### `scripts/switch-to-production-clerk.sh`
–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:
```bash
./scripts/switch-to-production-clerk.sh
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **Development –∫–ª—é—á–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã** - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å test –∫–ª—é—á–∞–º–∏
2. **Production –∫–ª—é—á–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã** - –±–µ–∑ live –∫–ª—é—á–µ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞
3. **Webhook –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** - –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã user management
4. **CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω** - —Ç–æ–ª—å–∫–æ –¥–ª—è redai.site –¥–æ–º–µ–Ω–∞

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ Production –∫–ª—é—á–∏ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ git
- ‚úÖ Test –∫–ª—é—á–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤ production
- ‚úÖ Webhook secrets –∑–∞—â–∏—â–µ–Ω—ã
- ‚úÖ CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω production –¥–æ–º–µ–Ω–æ–º

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/CLERK_PRODUCTION_SETUP.md`

## üÜò Troubleshooting

### –û—à–∏–±–∫–∞: "Clerk not properly configured"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏
node scripts/check-clerk-env.js

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ .env.production —Å–æ–¥–µ—Ä–∂–∏—Ç live –∫–ª—é—á–∏
cat .env.production | grep CLERK
```

### –û—à–∏–±–∫–∞: "Authentication disabled"
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è development —Ä–µ–∂–∏–º–∞. –í production —Ä–µ–∂–∏–º–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

### –û—à–∏–±–∫–∞: "Webhook not configured"
–°–æ–∑–¥–∞–π—Ç–µ webhook –≤ Clerk dashboard —Å URL: `https://redai.site/api/webhooks/clerk`

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ü–æ–ª—É—á–∏—Ç–µ production –∫–ª—é—á–∏ –æ—Ç Clerk
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç–µ `.env.production`
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ
4. ‚úÖ Deploy –Ω–∞ production —Å–µ—Ä–≤–µ—Ä
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

**–°—Ç–∞—Ç—É—Å**: Development —Ä–µ–∂–∏–º –æ—Ç–∫–ª—é—á–µ–Ω, –≥–æ—Ç–æ–≤ –∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—é –Ω–∞ production –∫–ª—é—á–∏. 