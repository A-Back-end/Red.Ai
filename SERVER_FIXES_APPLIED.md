# üîß Server Fixes Applied - Red.AI

## üö® **–ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:**

### 1. **–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤**
- **–ü—Ä–æ–±–ª–µ–º–∞:** `Failed to delete project` - 500 Internal Server Error
- **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É `database/projects.json` –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- **–†–µ—à–µ–Ω–∏–µ:** 
  - –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `appuser` –≤ Dockerfile.backend
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ database –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ docker-compose

### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–µ–∫—Ç—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è database –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω volume `./database:/app/database` –≤ docker-compose-redai-prod.yml

### 3. **–£–ª—É—á—à–µ–Ω–∏—è –≤ API –ø—Ä–æ–µ–∫—Ç–æ–≤**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `ensureDatabaseDirectory()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ —á—Ç–µ–Ω–∏–µ–º/–∑–∞–ø–∏—Å—å—é

## üìÅ **–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**

### 1. `Dockerfile.backend`
```dockerfile
# –î–æ–±–∞–≤–ª–µ–Ω–æ:
RUN mkdir -p uploads logs generated-images database
RUN chmod 755 uploads logs generated-images database

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
RUN groupadd -r appuser && useradd -r -g appuser appuser
RUN chown -R appuser:appuser /app

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
USER appuser
```

### 2. `app/api/projects/route.ts`
```typescript
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
async function ensureDatabaseDirectory(): Promise<void> {
  const dbDir = path.dirname(dbPath);
  try {
    await fs.access(dbDir);
  } catch {
    await fs.mkdir(dbDir, { recursive: true });
  }
}

// –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ writeProjects()
console.log(`Successfully wrote ${projects.length} projects to database`);
```

### 3. `docker-compose-redai-prod.yml`
```yaml
backend:
  volumes:
    - ./uploads:/app/uploads
    - ./public/generated-images:/app/generated-images
    - ./database:/app/database  # ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
```

## üõ†Ô∏è **–°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

### 1. `fix-server-issues.sh`
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –°–æ–∑–¥–∞—ë—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
- –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑—ã
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç API endpoints

### 2. `deploy-server-fix.sh`
- –û–±–Ω–æ–≤–ª—è–µ—Ç git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –ó–∞–ø—É—Å–∫–∞–µ—Ç fix-server-issues.sh
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## üöÄ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ redai.site:

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh user@redai.site

# 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/red-ai

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
./deploy-server-fix.sh
```

### –õ–æ–∫–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
./fix-server-issues.sh

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
npm run dev
```

## ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**

### 1. **–¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤:**
- –ó–∞–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "My Projects"
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–¥–∞–ª–∏—Ç—å –ª—é–±–æ–π –ø—Ä–æ–µ–∫—Ç
- –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫

### 2. **–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤:**
- –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –¥–∏–∑–∞–π–Ω –≤ "Design Studio"
- –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª–µ "My Projects"

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose -f docker-compose-redai-prod.yml logs -f

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose -f docker-compose-redai-prod.yml logs backend
```

## üîç **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤:
```bash
docker-compose -f docker-compose-redai-prod.yml ps
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:
```bash
docker-compose -f docker-compose-redai-prod.yml exec backend ls -la /app/database/
```

### –¢–µ—Å—Ç API endpoints:
```bash
# –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤
curl https://redai.site/api/projects?userId=test-user

# –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
curl -X POST https://redai.site/api/projects \
  -H "Content-Type: application/json" \
  -d '{"userId":"test","name":"Test","description":"Test"}'

# –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
curl -X DELETE https://redai.site/api/projects?projectId=test-id
```

## üö® **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è:**

### 1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
```bash
docker-compose -f docker-compose-redai-prod.yml logs --tail=50
```

### 2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:**
```bash
docker-compose -f docker-compose-redai-prod.yml restart
```

### 3. **–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑—ã:**
```bash
docker-compose -f docker-compose-redai-prod.yml up -d --build
```

### 4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
```bash
ls -la database/
sudo chown -R $USER:$USER database/
chmod 644 database/projects.json
```

## üìû **–ü–æ–¥–¥–µ—Ä–∂–∫–∞:**

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ —Ä–µ—à–µ–Ω—ã –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
2. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –∫ —Ñ–∞–π–ª–∞–º –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º
3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Docker** –∏ volumes
4. **–°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** –∏ firewall

---

**–î–∞—Ç–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** $(date)
**–í–µ—Ä—Å–∏—è:** 1.0.0
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ 